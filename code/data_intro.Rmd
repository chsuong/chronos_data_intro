---
title: "data_intro"
author: "Clara Suong"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  pdf_document: default
  word_document: default
  toc: yes
  html_document: default
---

```{r setup, include=FALSE}
#knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "/Users/clarahsuong/chronos_data_intro/")
#setwd("/Users/clarahsuong/chronos_data_intro/")
#knitr::opts_knit$set(root.dir=rprojroot::find_rstudio_root_file("/Users/clarahsuong/chronos_data_intro/"))
#knitr::opts_knit$set(root.dir = normalizePath(".."))
```

#Load libraries and set the working directory
```{r, results='hide'}
rm(list = ls()) 
library(plyr)
library(dplyr)
library(dbplyr)
library(tidyverse)
library(tidyquant) # Loads tidyverse, tidquant, financial pkgs, xts/zoo
library(xts) #Time series
library(RMySQL) #For connecting to the databse
library(htmlTable) #For creating Word-compatible tables
library(Hmisc)
library(expss) #For creating Word-compatible tables
library(sjlabelled)
library(lubridate)
library(foreign)
library(ggplot2)
library(reshape2)
library(readxl)
library(countrycode) #For reconciling different country codes across dataset
library(ISOcodes) #A package for ISO country codes
#library(MASS) #Negative binomial models
library(stargazer)
library(corrplot)
library(pglm)
#library(xtable)
library(gtools)

#setwd("/Users/clarahsuong/Dropbox/nyu_postdoc/ner/dataset_intro") #If necessary, set as the working directory a location where you can save large data files with file size over 100 mb (github limitation).
#Create a folder named "external_data" in the working directory
```

#Databases and external datasets

##Our MySQL databases
* declassification_cables
* declassification_ddrs
* declassification_frus
* declassification_kissinger
* declassification_pdb
* declassification_clinton 
* declassification_cabinet
* declassification_cpdoc

##Key fields/variables in our database 'declassification_cables'
* body
* subject
* date (year)
* classification
* urgency
* length
* (handling)
* (page_count)
* (line_count)
* office
* from_field
* to_field
* tag

* (Derived from TAGS below) 
* country
* person
* topic

* frus_match

* Cf. label dictionary: 
https://docs.google.com/document/d/13iM00ZfVzV-6mGw8YBGkJFnJFkLe011znb3LQenaIjM/edit?usp=sharing 

##External dataset sources:
* Download the following datasets in the folder "external_data"
* COW country codes (cow): http://www.correlatesofwar.org/data-sets/cow-country-codes/cow-country-codes/at_download/file
* U.S. diplomatic representation (us_dip_rep; COW-compatible version): https://www.dropbox.com/sh/2wnklx04vblnmi1/AABmMxbxvja_JVStsxKD4F2Qa?dl=0
* U.S. diplomatic visits (us_dip_vis): https://tinyurl.com/yyedcahu
* U.S. diplomatic appointments (us_dip_app): https://static-content.springer.com/esm/art%3A10.1007%2Fs11558-017-9277-0/MediaObjects/11558_2017_9277_MOESM1_ESM.zip
* UN voting (un_vote): https://dataverse.harvard.edu/dataset.xhtml?persistentId=hdl:1902.1/12379
* Actor-level International Crisis Behavior (icb; Version 12): https://sites.duke.edu/icbdata/data-collections/
* U.S. diplomatic events (us_dip_evt): https://www.dropbox.com/sh/d93tdqanxugvlvg/AAByV97aMEE1Ydh0mkihigrSa?dl=0

#Exploring the database 'declassification_cables'

##Connecting to the database 'declassification_cables'
```{r echo=FALSE}
driver = dbDriver("MySQL")
connection = dbConnect(driver,host='history-lab.org', password='XreadF403', user='de_reader')
mydb = dbConnect(driver,host='history-lab.org', password='XreadF403', 
                 user='de_reader', dbname='declassification_cables')
```

##Tables in the database 'declassification_cables'
```{r}
dbListTables(mydb)
#Note that many of the tables are yet to be populated (or in the process of being so).
```

##Exploring the main table 'docs' from the database 'declassification_cables'
```{r echo=FALSE}
dbListFields(mydb, 'docs')
print(dbGetQuery(mydb, "Describe docs;"))

#Download and save the table 'docs' in the working directory
#getwd()
#docs<-tbl(mydb, "docs")%>%
#  collect() 

#save(docs, file = "/Users/clarahsuong/Dropbox/nyu_postdoc/ner/dataset_intro/cfpf_docs.RData")
#load("/Users/clarahsuong/Dropbox/nyu_postdoc/ner/dataset_intro/cfpf_docs.RData")

#Note that not all cables with the value "full" for the variable "cable_type" actually include full text. 
#Also note that variables like "page_count" and "line_count" are not really valid for cables without full text.
#prop.table(table(docs$cable_type))
#head(docs[,c("cable_type","body")], 20)
```

##Examine the different country codes across datasets
```{r}

setwd("/Users/clarahsuong/chronos_data_intro")

#Re-connect to the database
driver = dbDriver("MySQL")
connection = dbConnect(driver,host='history-lab.org', password='XreadF403', user='de_reader')
mydb = dbConnect(driver,host='history-lab.org', password='XreadF403', user='de_reader', dbname='declassification_cables')

countries<-
  tbl(mydb, 'countries') %>% 
  collect() #Note that there is no tag for "South Vietnam" but tag "VM" (id: 557) for "Vietnam" according to this table. There is also no tag for Serbia and Montenegro.

#Create a tibble dataframe of various country codes and cable tag ids
#Note that this includes country codes and tag id for the US.

#Generate lists of all non-US (old and existing) countries. 
states<-
  read_csv("/Users/clarahsuong/chronos_data_intro/external_data/cow/states2016.csv") %>%
  dplyr::select("stateabb","ccode","statenme") %>%
  filter(!ccode==2) %>% #Leave out the US
  rename(cow_ccode=ccode,
         cow_stateabb=stateabb, 
         cow_statename=statenme) %>%   
  distinct() 

#Merge ISO_3166_1 and ISO_3166_3 (ISO country codes for withdrawn countries). Note that this list often omits retired codes. 
iso_3166<-
  tibble::as_tibble(left_join(ISO_3166_1, ISO_3166_3, by = c("Alpha_3","Numeric","Name")))%>%
  mutate(Numeric=as.integer(Numeric)) %>%
  dplyr::select("Alpha_3",
         "Numeric",
         "Name",
         "Official_name",
         "Common_name") 

country_code_tag<-
  tbl(mydb, 'countries') %>% 
  collect() %>%
  mutate(country_id=as.integer(id)) %>%
  dplyr::select(-id)

#Check whether the variable "country_id" in the table "countries" is from ISO 3166.
#Derive COW country codes from the variable "name" in the table "countries."
country_code_tag$cow_ccode<-countrycode(country_code_tag$name, 'country.name', 'cown') #cow_ccode for Vietnam should be 816, not 817 (error in the package countrycode) and cow_ccode for West Germany (German Federal Republic) should be 260.
#country_code_tag$cowid2<-countrycode(country_code_tag$country_id, 'iso3n', 'cown')
country_code_tag$iso3n<-countrycode(country_code_tag$name, 'country.name', 'iso3n') #iso3n for South Vietnam should not be 704 (country code of Vietnam) (error in the package countrycode).

all(country_code_tag$country_id %in% iso_3166$Numeric)
all(iso_3166$Numeric %in% country_code_tag$country_id)
setdiff(country_code_tag$country_id, iso_3166$Numeric)
country_code_tag[country_code_tag$country_id %in% setdiff(country_code_tag$country_id, iso_3166$Numeric),]
#Most of the items with a discrepancy between the database's country ids and iso-3166 numeric seem to be defunct states or non-state entities, except East and West Germany.

#Focus on countries by dropping the observations with missing tag_id or COW country code.
country_code_tag<-
  country_code_tag[!is.na(country_code_tag$cow_ccode) & !is.na(country_code_tag$tag_id),] %>%
  mutate(cow_ccode= replace(cow_ccode, name=="Vietnam", 816)) %>% #Fix cow_ccode for Vietnam 
  mutate(cow_ccode= replace(cow_ccode, name=="West Germany", 260)) %>% #Fix cow_ccode for West Germany (German Federal Republic) 
  left_join(states, by="cow_ccode") %>% 
  rename(country_name=name) %>%
  dplyr::select(-iso3n) 
#Germany and West Germany share their COW country codes.

#Create a tibble dataframe of all countries that were potential diplomatic counterparts of the US in the 1970s.

#Generate lists existing non-US country-year pairs for the 1970s (a universe of all possible diplomatic relations between US and other countries). Note that the dataframe below does NOT include the US but only all potential US countries who existed in the 1970s. For comparability with other datasets, we focus on the universe of potential diplomatic partners of the U.S., that is, countries that existed in the 1970s. Note that the universe of countries would differ by year!

states_70s<-
  read_csv("/Users/clarahsuong/chronos_data_intro/external_data/cow/states2016.csv") %>%
  dplyr::select("ccode", "styear", "endyear") %>%
  filter(!ccode==2) %>% #Leave out the US
  rename(cow_ccode=ccode) %>% #,cow_stateabb=stateabb, cow_statename=statenme) 
  rowwise() %>%
  do(data.frame(cow_ccode = .$cow_ccode, year = seq(.$styear, .$endyear, by = 1))) %>%
  filter(year>1972 & year<1980) %>%
  left_join(states, by="cow_ccode") 

#  read_csv("./external_data/lebovic_saunders_2016/diplomatic_core.replication.csv") %>%
#  filter(year>1969 & year<1981) %>%
#  dplyr::select(cowid, year) %>%
#  rename(cow_ccode=cowid) %>%
#  left_join(cow, by=c("cow_ccode"="CCode")) %>%
#  rename(cow_stateabb=StateAbb, 
#         cow_statename=StateNme) %>%
#  filter(!cow_ccode==818)

#The dataset by Lebovic and Saunders includes many errors:
#it includes country code 818 but none of the COW country datasets include it. Drop the row with cow_ccode=818.
#it also includes 0s for countries non-existent in the 1970s as a potential diplomatic partner (e.g. Croatia with country code 344 and Bosnia and Herzegovina with country code 346).

#Note: cannot automatically complete the data frame with missing combinations of data (function complete) because we need to account for the difference in countries' birth date. Use the dataframe us_dip_vis below for now. Create the full list of country-year combinations later.  
```

#Cable traffic by country

##Download, save, or load the tables for tags and docs (doc_id and date) in the working directory and count the number of cables tagged for each country
```{r results='hide', message=FALSE, warning=FALSE}

setwd("/Users/clarahsuong/chronos_data_intro")

#Re-connect to the database
#driver = dbDriver("MySQL")
#connection = dbConnect(driver,host='history-lab.org', password='XreadF403', user='de_reader')
#mydb = dbConnect(driver,host='history-lab.org', password='XreadF403', user='de_reader', dbname='declassification_cables')

tags<-
  tbl(mydb, 'tags') %>% 
  dplyr::select(id, tag, category) #%>% collect()

tag_doc<-
  tbl(mydb, 'tag_doc') #%>% collect()

doc_date2<-
  tbl(mydb, 'docs') %>% 
  dplyr::select(id, date) %>%
  rename(doc_id=id) #%>% collect()

#tag_doc2<-
#  tag_doc%>%
#  inner_join(tags, by = c("tag_id"="id")) %>%
#  inner_join(doc_date2, by = "doc_id") %>%
#  mutate(year=lubridate::year(date), 
#         month=lubridate::month(date), 
#         date=lubridate::ymd(date), 
#         ym=as.yearmon(paste(year, month),"%Y %m")
#         ) %>%
#  collect() 
#save(tag_doc2, file = "../data/tag_doc2.RData")
#load("./data/tag_doc2.RData")

#tag_doc2_country <-
#  tag_doc2 %>%
#  inner_join(country_code_tag, by="tag_id") 
#save(tag_doc2_country, file = "../data/tag_doc2_country.RData")
#load("./data/tag_doc2_country.RData")

#cable_n_country_date<-
#  tag_doc2_country %>%
#  group_by(.dots=c("tag_id", 
#                   "country_id", 
#                   "cow_ccode", 
#                   "country_name", 
#                   "date")) %>%
#  tally() 
#save(cable_n_country_date, file = "../data/cable_n_country_date.RData")
load("./data/cable_n_country_date.RData") #Note that this does neither all dates nor all countries on the COW list.

#Yearly cable traffic by country-year, including 0 cables by some countries that existed in the 1970s. Note that this does NOT include the cables tagged with US, due to the dataframe states_70s. 
cable_n_70s_country_year<-
  cable_n_country_date %>%
  mutate(year=lubridate::year(date)) %>%
  group_by(year, cow_ccode) %>%
  summarise(n_c_y = sum(n)) %>%
  right_join(states_70s, by=c("year", "cow_ccode"))%>%
  mutate(n_c_y= replace(n_c_y, is.na(n_c_y), 0)) %>%
  ungroup %>%
  mutate(total_n = sum(n_c_y)) %>%
  arrange(year, cow_ccode)

#Yearly cable traffic by country-year, including 0 cables by some countries that existed anytime before 2016. Note that this does NOT include the cables tagged with US. 
#cable_n_country_year<-
#  cable_n_country_date %>%
#  mutate(year=lubridate::year(date)) %>%
#  group_by(year, cow_ccode, country_name) %>%
#  summarise(n_c_y = sum(n)) %>%
#  full_join(states, by="cow_ccode")%>%
#  select(-country_name) %>%
#  mutate(n_c_y= replace(n_c_y, is.na(n_c_y), 0)) %>%
#  ungroup %>%
#  mutate(total_n = sum(n_c_y)) %>%
#  arrange(year, cow_ccode)
```

##Examine cables tagged with certain countries as a test
```{r}
#Check tag_id for certain countries
country_code_tag%>%filter(str_detect(country_name, 'China'))
country_code_tag%>%filter(str_detect(country_name, 'Korea'))
country_code_tag%>%filter(str_detect(country_name, 'Viet'))
country_code_tag%>%filter(str_detect(country_name, 'Afghan'))
country_code_tag%>%filter(str_detect(country_name, 'Iran'))
country_code_tag%>%filter(str_detect(country_name, 'Germany'))
country_code_tag%>%filter(str_detect(country_name, 'Egypt'))

cable_china<-
  tag_doc2 %>%
  filter(tag_id==386) %>%
  group_by(date) %>%
  tally() 
  
cable_nkorea<-
  tag_doc2 %>%
  filter(tag_id==453)%>%
  group_by(date) %>%
  tally() 

cable_viet<-
  tag_doc2 %>%
  filter(tag_id==557) %>%
  group_by(date) %>%
  tally() 
#Note that the tag for South Vietnam is "deleted" and its tag_id missing.

cable_afghan<-
  tag_doc2 %>%
  filter(tag_id==342) %>%
  group_by(date) %>%
  tally()

cable_iran<-
  tag_doc2 %>%
  filter(tag_id==440) %>%
  group_by(date) %>%
  tally() 

cable_east_germany<-
  tag_doc2 %>%
  filter(tag_id==419) %>%
  group_by(date) %>%
  tally() 

cable_egypt<-
  tag_doc2 %>%
  filter(tag_id==402) %>%
  group_by(date) %>%
  tally() 
```

##Summary statistics of cable traffic by country-year
```{r}
setwd("/Users/clarahsuong/chronos_data_intro")

stargazer(as.data.frame(cable_n_70s_country_year)[c("year", "cow_ccode", "n_c_y")], 
          type = "text", 
          title="Summary Statistics of Cable Traffic by Country-Year", 
          digits=1, 
          out="./data_analysis_output/desc_cable_n_country_year.txt",
          covariate.labels=c("Year", "COW Codes of Countries Tagged by Cables", "Cable Traffic for Each Country-Year"))

stargazer(as.data.frame(cable_n_70s_country_year)[c("year", "cow_ccode", "n_c_y")], 
          type = "html", 
          title="Summary Statistics of Cable Traffic by Country-Year", 
          digits=1, 
          out="./data_analysis_output/desc_cable_n_country_year.html",
          covariate.labels=c("Year", "COW Codes of Countries Tagged by Cables", "Cable Traffic for Each Country-Year"))
```

##Country-years with most cables
```{r}
setwd("/Users/clarahsuong/chronos_data_intro")

table_country_year_top10<- 
  cable_n_70s_country_year %>%
  mutate(rel.freq = paste0(round(100 * n_c_y/total_n, 0), "%")) %>%
  arrange(desc(n_c_y)) %>%
  top_n(n = 10, wt = n_c_y) 

stargazer(table_country_year_top10[c("year", "cow_statename", "n_c_y","rel.freq")],
          summary = FALSE,
          rownames = FALSE,
          type = "text", 
          title="Country-Years with Most Cables", 
          digits=1, 
          out="./data_analysis_output/top10_cable_n_country_year.txt",
          covariate.labels=c("Year","Tagged Country", "Number of Cables", "Relative Frequency"))

stargazer(table_country_year_top10[c("year", "cow_statename", "n_c_y","rel.freq")],
          summary = FALSE,
          rownames = FALSE,
          type = "html", 
          title="Country-Years with Most Cables", 
          digits=1, 
          out="./data_analysis_output/top10_cable_n_country_year.html",
          covariate.labels=c("Year","Tagged Country", "Number of Cables", "Relative Frequency"))
```

##Country-years with fewest cables
```{r}
setwd("/Users/clarahsuong/chronos_data_intro")

table_country_year_bottom10<- 
  cable_n_70s_country_year %>%
  mutate(rel.freq = paste0(round(100 * n_c_y/total_n, 0), "%")) %>%
  arrange(desc(n_c_y)) %>%
  #filter(n_c_y<10) 
  top_n(n = -10, wt = n_c_y) 

stargazer(table_country_year_bottom10[c("year", "cow_statename", "n_c_y","rel.freq")],
          summary = FALSE,
          rownames = FALSE,
          type = "text", 
          title="Country-Years with Fewest Cables", 
          digits=1, 
          out="./data_analysis_output/bottom10_cable_n_country_year.txt",
          covariate.labels=c("Year","Tagged Country", "Number of Cables", "Relative Frequency"))

stargazer(table_country_year_bottom10[c("year", "cow_statename", "n_c_y","rel.freq")],
          summary = FALSE,
          rownames = FALSE,
          type = "html", 
          title="Country-Years with Fewest Cables", 
          digits=1, 
          out="./data_analysis_output/bottom10_cable_n_country_year.html",
          covariate.labels=c("Year","Tagged Country", "Number of Cables", "Relative Frequency"))
```

##Countries most frequently tagged in cables
```{r}
setwd("/Users/clarahsuong/chronos_data_intro")

table_country_top10<- 
  cable_n_70s_country_year %>%
  group_by(cow_ccode, cow_stateabb, cow_statename) %>% 
  summarise(n_c = sum(n_c_y)) %>%
  ungroup %>%
  mutate(total_n_c= sum(n_c), 
         rel.freq = paste0(round(100 * n_c/total_n_c, 0), "%")) %>%
  arrange(desc(n_c)) %>%
  top_n(n = 10, wt = n_c) 

stargazer(table_country_top10[c("cow_statename", "n_c","rel.freq")],
          summary = FALSE,
          rownames = FALSE,
          type = "text", 
          title="Countries Most Frequently Tagged in Cables", 
          digits=1, 
          out="./data_analysis_output/top10_cable_n_country.txt",
          covariate.labels=c("Country", "Number of Cables", "Relative Frequency"))

stargazer(table_country_top10[c("cow_statename", "n_c","rel.freq")],
          summary = FALSE,
          rownames = FALSE,
          type = "html", 
          title="Countries Most Frequently Tagged in Cables", 
          digits=1, 
          out="./data_analysis_output/top10_cable_n_country.html",
          covariate.labels=c("Country", "Number of Cables", "Relative Frequency"))
```

##Countries least frequently tagged in cables
```{r}
setwd("/Users/clarahsuong/chronos_data_intro")

table_country_bottom10<- 
  cable_n_70s_country_year %>%
  group_by(cow_ccode, cow_stateabb, cow_statename) %>% 
  summarise(n_c = sum(n_c_y)) %>%
  ungroup %>%
  mutate(total_n_c= sum(n_c), 
         rel.freq = paste0(round(100 * n_c/total_n_c, 0), "%")) %>%
  arrange(desc(n_c)) %>%
  top_n(n = -10, wt = n_c) 

stargazer(table_country_bottom10[c("cow_statename", "n_c","rel.freq")],
          summary = FALSE,
          rownames = FALSE,
          type = "text", 
          title="Countries Least Frequently Tagged in Cables", 
          digits=1, 
          out="./data_analysis_output/bottom10_cable_n_country.txt",
          covariate.labels=c("Country", "Number of Cables", "Relative Frequency"))

stargazer(table_country_bottom10[c("cow_statename", "n_c","rel.freq")],
          summary = FALSE,
          rownames = FALSE,
          type = "html", 
          title="Countries Least Frequently Tagged in Cables", 
          digits=1, 
          out="./data_analysis_output/bottom10_cable_n_country.html",
          covariate.labels=c("Country", "Number of Cables", "Relative Frequency"))
```

#U.S. diplomatic representation

##No need to import and load the COW data for U.S. diplomatic representation
```{r echo=FALSE}
#us_dip_rep_cow<-  read_csv("./external_data/cow_diplomatic_exchange_2006.1/Diplomatic_Exchange_2006v1.csv", locale = locale(encoding = "UTF-8")) 
```

##Import and load the Moyer data for U.S. diplomatic representation
```{r}

setwd("/Users/clarahsuong/chronos_data_intro")

us_dip_rep_moyer<-
  read_csv("./external_data/moyer_et_al_2016/Pardee Center Diplomatic Representation_COW 20190208.csv", locale = locale(encoding = "UTF-8")) %>% #COW-compatible version
#  read_excel("../external_data/moyeretal2016/Diplomatic_Exchange_V3.16.16.xlsx") %>% #Non-compatible, public version
  mutate(Year=as.numeric(Year)) %>%
  rename(year = Year) %>%
  filter(Country=="United States of America") %>%
  mutate(cow_ccode=countrycode(Destination, 'country.name', 'cown')) %>% #us_dip_rep[is.na(us_dip_rep$cow_ccode),] COW country code for German Federal Republic is wrong and should be 260, not 255.
  mutate(cow_ccode= replace(cow_ccode, Destination=="German Federal Republic", 260)) %>%
  right_join(states_70s, by=c("year", "cow_ccode")) %>% #Note the missing values for Destination but not cow_ccode.
  arrange(cow_ccode, year) %>%
  #mutate(date = ymd(paste0(year, "-", 06, "-", 01))) %>%
  mutate(dip_rep_m=ifelse(is.na(`Embassy Old`),0, 1)) %>% #Created a variable for US representation. The dataset by Arias and Smith 2018 seems more accurate. This dataset misses the case of U.S. embassy in the Bahamas in 1973-75 wherease the latter includes it.
  rename(dip_focus=`Focus New`) %>%
  mutate(dip_focus=replace(dip_focus, dip_rep_m==0, 0)) %>%
  dplyr::select(cow_ccode, year, dip_rep_m, dip_focus)
#The codebook is outdated and omits important information. It seems like the value 0 for the variable "Focus New" represents unreciprocated cases.   
#sum(is.na(us_dip_rep_moyer$`Embassy Old`)) is the same as:
#sum(is.na(us_dip_rep_moyer$`Focus New`))
```

```{r, echo=FALSE}
#Examine some countries
us_dip_rep_china<-
  filter(us_dip_rep2, cow_ccode==710) %>%
  mutate(dip_rep=ifelse(`Embassy New`==6,1, NA))

#Note that the dataset is inaccurately referring to South Vietnam as Vietnam.
#us_dip_rep_viet<-
#  filter(us_dip_rep2, cow_ccode==816) %>%
#  mutate(dip_rep=ifelse(`Embassy New`==6,1, NA))

us_dip_rep_iran<-
  filter(us_dip_rep2, cow_ccode==630) %>%
  mutate(dip_rep=ifelse(`Embassy New`==6,1, NA))

us_dip_rep_afghan<-
  filter(us_dip_rep2, cow_ccode==700) %>%
  mutate(dip_rep=ifelse(`Embassy New`==6,1, NA))

#No diplomatic relations between the U.S. and (North) Vietnam until 1995
#No formal relations between the U.S. and North Korea
```

##Import Arias and Smith's data on diplomatic appointment and representation
```{r}  
setwd("/Users/clarahsuong/chronos_data_intro")

#Save the dta file as a csv file and read in the csv file
#write.csv(read.dta("./external_data/arias_smith_2018/ambassadors.dta"),"../external_data/arias_smith_2018/ambassadors.csv")

us_dip_rep_app <-  
  read_csv("./external_data/arias_smith_2018/ambassadors.csv", guess_max = 100000, locale = locale(encoding = "UTF-8")) %>%
  dplyr::select(year, ccode, country_ambassador, ambassador, position, politicalappointee,performanceMU,good, bad) %>%
  rename(cow_ccode=ccode, ambassador_name=ambassador) %>%
  right_join(states_70s, by=c("cow_ccode", "year")) %>%  
  arrange(cow_ccode, year) %>%
  mutate(dip_rep_a=ifelse(is.na(country_ambassador),0, 1)) %>% #Created a variable for inferred US representation. Check this variable against the dataset by Moyer 2016. There may be a discrepancy due to bureaucratic delays and so on. For instance, there may be a diplomatic relationship but there is a delay in confirming him/her and the DCM serves as CM instead. 
  mutate(ambassador=ifelse(position=="Ambassador Extraordinary and Plenipotentiary",1, 0))
```

#U.S. Diplomatic Visits

##Import and load the data on U.S. diplomatic visits
```{r}
setwd("/Users/clarahsuong/chronos_data_intro")

#Save the dta file as a csv file
#write.csv(read.dta("diplomatic_core.replication.dta"),"./external_data/lebovic_saunders_2016/diplomatic_core.replication.csv")

#Note that the paper (LEBOVIC AND SAUNDERS 2016) mentions the variable for crisis (Crisis Shocks from the International Crisis Behavior Project) but the dataset actually does not include it. The paper notes that "regularized patterns [of U.S. diplomatic visits] that we discern are not products of crisis diplomacy and that crises do not strongly affect the results" (p.119).
us_dip_vis<-
  read_csv("./external_data/lebovic_saunders_2016/diplomatic_core.replication.csv", locale = locale(encoding = "UTF-8")) %>%
  dplyr::select(cowid, year, bi_PRE, bi_SOS) %>%#, mil_ratio, USmilaid, allies, USdefense, USdefense_EUR, UStrade, energypc, USalign, UNpart, mpower, term2, NIX, FOR, CAR, demo, bi_L1_PRE, EUR, AFR, MEA, SCA, EAP, bi_L14_SOS, bi_L14_PRE, bi_L58_SOS, bi_L58_PRE) %>%
  rename(cow_ccode=cowid) %>%
  right_join(states_70s, by=c("cow_ccode", "year"))  
  #mutate(un_member= ifelse(!is.na(UNpart),1, NA)) #Check whether newly admitted states participate in UN voting only the year after

#a<-us_dip_vis[us_dip_vis$UNpart==0,]
```

##Examine cables tagged with certain countries as a test
```{r}

us_dip_vis_china<-
  filter(us_dip_vis, cowid==710)

us_dip_vis_nkorea<-
  filter(us_dip_vis, cowid==731)

us_dip_vis_viet<-
  filter(us_dip_vis, cowid==816)

us_dip_vis_iran<-
  filter(us_dip_vis, cowid==630)

us_dip_vis_afghan<-
  filter(us_dip_vis, cowid==700)

us_dip_vis_egypt<-
  filter(us_dip_vis, cowid==651)

us_dip_vis_east_germany<-
  filter(us_dip_vis, cowid==265)
```

#U.S. Diplomatic Events

#Import and load the data on US diplomatic events
```{r results="hide"}
setwd("/Users/clarahsuong/chronos_data_intro")

us_dip_evt<-
  read_csv("./external_data/carter_2018/AmericanDiplomacyDataset.csv") 

#Check whether the country abbreviations are from COW or ISO-3166.
all(us_dip_evt$source %in% country_code_tag$cow_stateabb)
all(us_dip_evt$target %in% country_code_tag$cow_stateabb)
all(us_dip_evt$source %in% iso_3166$Alpha_3)
all(us_dip_evt$target %in% iso_3166$Alpha_3)

setdiff(us_dip_evt$source, country_code_tag$cow_stateabb)
setdiff(us_dip_evt$target, country_code_tag$cow_stateabb)
setdiff(us_dip_evt$source, iso_3166$Alpha_3)
setdiff(us_dip_evt$target, iso_3166$Alpha_3)

all(setdiff(us_dip_evt$target, iso_3166$Alpha_3) %in% us_dip_evt$target)
all(setdiff(us_dip_evt$source, iso_3166$Alpha_3) %in% us_dip_evt$source)
all(setdiff(us_dip_evt$target, iso_3166$Alpha_3) %in% iso_3166$Alpha_3)
all(setdiff(us_dip_evt$source, iso_3166$Alpha_3) %in% iso_3166$Alpha_3)

us_dip_evt[us_dip_evt$target %in% setdiff(us_dip_evt$target, iso_3166$Alpha_3),]
us_dip_evt[us_dip_evt$source %in% setdiff(us_dip_evt$source, iso_3166$Alpha_3),]

#It looks like the variables "target" and "source" in the dataset are "the 2-character FIPS10-4 country code for the location" (http://data.gdeltproject.org/documentation/ISA.2013.GDELT.pdf). But these seem to overlap a lot with iso3c

#Entities with missing COW country codes are non-state. Let's drop or fix them.
#table(us_dip_evt[is.na(us_dip_evt$cow_ccode_source),]$source)
#table(us_dip_evt[is.na(us_dip_evt$cow_ccode_target),]$target)
#AUH: Abu Dhabi before it became part of UAE in December 1971. 
#BMU: Bermuda
#CYM: Cayman Islands 
#HKG: Hong Kong before it became part of China in 1997
#PSE: Palestine
#SER: Yugoslavia? (https://wits.worldbank.org/wits/wits/witshelp/content/codes/country_codes.htm)
#TBT: Tibet (Dalai Lama visited the US on Sep.3-Oct.21, 1979 (https://www.dalailama.com/the-dalai-lama/events-and-awards/travels/travels-1959-1979).)  
#TMP: East Timor (https://wits.worldbank.org/wits/wits/witshelp/content/codes/country_codes.htm)
#VMN: a typo for VNM (Vietnam)? 
#YUG: Transitional reservations for former Yugoslavia/Serbia and Montenegro (https://en.wikipedia.org/wiki/ISO_3166-1_alpha-3 https://wits.worldbank.org/wits/wits/witshelp/content/codes/country_codes.htm)

us_dip_evt<-
  read_csv("./external_data/carter_2018/AmericanDiplomacyDataset.csv", locale = locale(encoding = "UTF-8")) %>%
  #filter(1969<year & year<1981) %>%
  mutate(cow_ccode_source=countrycode(source, 'iso3c','cown'),
       cow_ccode_target=countrycode(target, 'iso3c','cown')) %>%
#  mutate(cow_ccode_source= replace(cow_ccode_source, source=="YUG", 345), #The function countrycode did not identify "YUG" as Yugoslavia.
#         cow_ccode_target = replace(cow_ccode_target, target=="YUG", 345), #The function countrycode did not identify "YUG" as Serbia, then part of Yugoslavia.
#         cow_ccode_source= replace(cow_ccode_source, source=="SER", 345), #The function countrycode did not identify "SER" as Serbia, then part of Yugoslavia.
#         cow_ccode_target = replace(cow_ccode_target, target=="SER", 345)) #The function countrycode did not identify "SER" as Serbia, then part of Yugoslavia.
  mutate(cow_ccode=ifelse(cow_ccode_source==2,cow_ccode_target, cow_ccode_source),
         ccode_type=ifelse(cow_ccode_source==2,"target", "source")
         ) %>%
  select(year, cow_ccode, ccode_type, vcoop, mcoop, vcon, mcon) %>%
  filter(!is.na(cow_ccode))  %>%
  group_by(.dots=c("year","cow_ccode")) %>%
  tally() %>%
  right_join(states_70s, by=c("cow_ccode", "year")) %>%
  rename(evt_n_c_y=n) %>%
  mutate(evt_n_c_y= replace(evt_n_c_y, is.na(evt_n_c_y), 0))
```

```{r echo=FALSE}
#Import and load the data on international crises

icb<-
  read_csv("../external_data/icb/icb2v12.csv") %>%
#Rule out crises that end before 1970 and crises that start after 1979
  filter(yrterm>1969 & systrgyr<1980) %>%
  mutate(ym_term=as.yearmon(paste(yrterm, moterm),"%Y %m"), 
         ym_trg=as.yearmon(paste(systrgyr, systrgmo), "%Y %m"), 
         duration=(ym_term-ym_trg)*12) #%>% #Some crises are missing the day of occurence but most have the month and the year.

#Note that the longest duration of a crisis (from a trigger event to its termination) is 3 years.
#max(icb$yrterm-icb$systrgyr, na.rm=TRUE)
```

#Compare the ambassador-country-year data
```{r}
us_dip_rep_app_cable_n_vis<-
  us_dip_rep_app %>%
  left_join(us_dip_rep_moyer, by=c("cow_ccode", "year")) %>%
  left_join(cable_n_country_year, by=c("cow_ccode", "year")) %>% #Note NAs for country_ambassor and country_name
  left_join(us_dip_vis, by=c("cow_ccode", "year")) %>%
  dplyr::select(-c(country_ambassador, ambassador_name, position, country_name, dip_rep_a))
```  

##Descriptive statistics
```{r}
setwd("/Users/clarahsuong/chronos_data_intro")

stargazer(as.data.frame(us_dip_rep_app_cable_n_vis), 
          type = "html", 
          title="Summary Statistics of the Ambassador-Country-Year Level Data", 
          digits=1, 
          out="./data_analysis_output/desc_us_dip_rep_app_cable_n_vis.html"#,
          #covariate.labels=c("Miles/(US)gallon",)
          )
```

##Correlation plots
```{r}
M<-cor(us_dip_rep_app_cable_n_vis, use = "complete.obs")
M
corrplot(M, method = "ellipse")
#corrplot.mixed(M)

res1 <- cor.mtest(us_dip_rep_app_cable_n_vis, conf.level = .95)
res2 <- cor.mtest(us_dip_rep_app_cable_n_vis, conf.level = .99)

## specialized the insignificant value according to the significant level
corrplot(M, p.mat = res1$p, sig.level = .05)
```

#Compare the country-year datasets
```{r}
us.cable_n.rep_m.vis.evt<-
  cable_n_70s_country_year %>%
  left_join(us_dip_rep_moyer, by=c("cow_ccode", "year")) %>% 
  left_join(us_dip_vis, by=c("cow_ccode", "year","cow_stateabb","cow_statename")) %>%
  left_join(us_dip_evt, by=c("cow_ccode", "year","cow_stateabb","cow_statename")) 
```  

```{r echo=FALSE}
theme_set(theme_bw())
ggplot(us.cable_n.rep_m.vis.evt,
       aes(x,y,colour=factor(i)))+
  geom_point(position=position_jitter(width=0.01))+
  theme(legend.position="none")
```  

##Correlation plots
```{r}
M<-cor(us.cable_n.rep_m.vis.evt[c("n_c_y","dip_rep_m","dip_focus","bi_PRE","bi_SOS","evt_n_c_y")], use = "complete.obs")
M
corrplot(M, method = "ellipse")
#corrplot.mixed(M)

res1 <- cor.mtest(us.cable_n.rep_m.vis.evt[c("n_c_y","dip_rep_m","dip_focus","bi_PRE","bi_SOS","evt_n_c_y")], conf.level = .95)
res2 <- cor.mtest(us.cable_n.rep_m.vis.evt[c("n_c_y","dip_rep_m","dip_focus","bi_PRE","bi_SOS","evt_n_c_y")], conf.level = .99)

corrplot(M, p.mat = res1$p, sig.level = .05)
```

##Fixed Effects
```{r, results='asis', warning=FALSE,message=FALSE}
setwd("/Users/clarahsuong/chronos_data_intro")

fixed1.1 <- pglm(n_c_y~
                   dip_rep_m#+
                   #dip_focus+
                   #bi_PRE+
                   #bi_SOS+
                   #evt_n_c_y
               ,
               data=us.cable_n.rep_m.vis.evt, 
               index=c("cow_ccode", "year"), 
               family = negbin, 
               model="within", 
               method = "nr"
              )
m1.1=summary(fixed1.1)

fixed1.2 <- pglm(n_c_y~
                   dip_rep_m+
                   dip_focus#+
                   #bi_PRE+
                   #bi_SOS+
                   #evt_n_c_y
               ,
               data=us.cable_n.rep_m.vis.evt, 
               index=c("cow_ccode", "year"), 
               family = negbin, 
               model="within", 
               method = "nr"
              )
m1.2=summary(fixed1.2)

fixed1.3 <- pglm(n_c_y~
                   dip_rep_m+
                   dip_focus+
                   bi_PRE#+
                   #bi_SOS+
                   #evt_n_c_y
               ,
               data=us.cable_n.rep_m.vis.evt, 
               index=c("cow_ccode", "year"), 
               family = negbin, 
               model="within", 
               method = "nr"
              )
m1.3=summary(fixed1.3)

fixed1.4 <- pglm(n_c_y~
                   dip_rep_m+
                   dip_focus+
                   bi_PRE+
                   #bi_SOS+
                   
                   evt_n_c_y
               ,
               data=us.cable_n.rep_m.vis.evt, 
               index=c("cow_ccode", "year"), 
               family = negbin, 
               model="within", 
               method = "nr"
              )
m1.4=summary(fixed1.4)

fixed1.8 <- pglm(n_c_y~
                   dip_rep_m+
                   dip_focus+
                   #bi_PRE+
                   bi_SOS+
                   evt_n_c_y
               ,
               data=us.cable_n.rep_m.vis.evt, 
               index=c("cow_ccode", "year"), 
               family = negbin, 
               model="within", 
               method = "nr"
              )
m1.8=summary(fixed1.8)

```

```{r}
var = c('Intercept', 
        "dip_rep_m",
        "dip_focus", 
        "bi_PRE", 
        #"bi_SOS",
        "evt_n_c_y")

model=summary(fixed1.4)

model_summary <- 
  model$estimate %>% 
  as.data.frame() %>% 
  dplyr::mutate(term = var, 
         Estimate = round(Estimate, 2), 
         SE = round(`Std. error`, 2), 
         p.value = stars.pval(`Pr(> t)`)) %>% 
 select(term, Estimate, SE, p.value) %>%
 set_caption("Table: Negative Binomial Regression of Country-Year's Number of Cables") %>%
 htmlTable(ctable=c("solid", "double"),rnames = FALSE)

#write_tableHTML(tableHTML(as.data.frame(model_summary)), file = #'negbin.cable_n_c_y.html')

model_summary

#xtable(model_summary)

tab_model(m1.1, m1.2,
        #labelDependentVariables=labdep,
        #labelPredictors=lab,
        file="or_table4.html",
        pvaluesAsNumbers=T,
        separateConfColumn=T)
```

stargazer(fixed1.1,
          fixed1.2,
          fixed1.3,          
          fixed1.4,
          type="html",
          dep.var.labels=c("Number of Cables Tagged"),
          #covariate.labels=c("Gross horsepower","Rear axle ratio","Four foward gears","Five forward gears","Type of transmission (manual=1)"), 
          out="./data_analysis_output/negbin_cable_n_c_y.html")
```


fixed2 <- pglm(n_c_y~
                   dip_rep_m+
                   dip_focus+
                   #bi_PRE+
                   bi_SOS+
                   evt_n_c_y
               ,
               data=us.cable_n.rep_m.vis.evt, 
               index=c("cow_ccode", "year"), 
               family = negbin, 
               model="within", 
               method = "nr"
              )
#summary(fixed2)

```

# "pooling"
pooling1 <- pglm(n_c_y~
                   dip_rep_m+
                   dip_focus+
                   bi_PRE+
                   #bi_SOS+
                   evt_n_c_y,
                 data=us.cable_n.rep_m.vis.evt, 
                 index=c("cow_ccode", "year"), 
                 family = negbin, 
                 model="pooling", 
                 method = "nr"
                 )
summary(pooling1)

pooling2 <- pglm(n_c_y~
                   dip_rep_m+
                   #dip_focus+
                   bi_PRE+
                   #bi_SOS+
                   evt_n_c_y,
                 data=us.cable_n.rep_m.vis.evt, 
                 index=c("cow_ccode", "year"), 
                 family = negbin,
                 index=c("cow_ccode", "year"), family = negbin, model="pooling"#, method = "nr"
              )
summary(pooling2)

cable_n_irep_app<-
  cable_n_country_y %>%
  inner_join(us_dip_irep_app, by=c("year", "cow_ccode")) 

glm.nb_irep1 <- glm.nb(n_c_y~dip_irep, data = cable_n_irep_app)

glm.nb_amb <- glm.nb(n_c_y~ambassador, data = cable_n_irep_app)

glm.nb_politicalappointee <- glm.nb(n_c_y~politicalappointee, data = cable_n_irep_app)

glm.nb_good <- glm.nb(n_c_y~good, data = cable_n_irep_app)

glm.nb_bad <- glm.nb(n_c_y~bad, data = cable_n_irep_app)

stargazer(glm.nb_irep1,
          glm.nb_amb,
          glm.nb_politicalappointee, 
          glm.nb_good,
          glm.nb_bad,
          type="text",
          dep.var.labels=c("Number of Cables Tagged"),
          #covariate.labels=c("Gross horsepower","Rear axle ratio","Four foward gears","Five forward gears","Type of transmission (manual=1)"), 
          out="../data_analysis_output/cable_n_irep_app.txt")

stargazer(glm.nb_irep1,
          glm.nb_amb,
          glm.nb_politicalappointee, 
          glm.nb_good,
          glm.nb_bad,
          type="html",
          dep.var.labels=c("Number of Cables Tagged"),
          #covariate.labels=c("Gross horsepower","Rear axle ratio","Four foward gears","Five forward gears","Type of transmission (manual=1)"), 
          out="../data_analysis_output/cable_n_irep_app.html")


```

#Slightly modified from the analysis in Lebovic and Saunders (2016)' Tables 3 and 4
glm.nb_pre2 <- glm.nb(n_c_y~bi_PRE+mil_ratio+USmilaid+allies+USdefense+USdefense_EUR+UStrade+energypc+USalign+UNpart+mpower+FOR+CAR+demo+bi_L1_PRE+EUR+AFR+MEA+SCA+EAP, data = cable_n_vis_country_y)
#Cluster by cowid

glm.nb_sos2 <- glm.nb(n_c_y~bi_SOS+mil_ratio+USmilaid+allies+USdefense+USdefense_EUR+UStrade+energypc+USalign+UNpart+mpower+FOR+CAR+demo+bi_L1_PRE+EUR+AFR+MEA+SCA+EAP, data = cable_n_vis_country_y)
#Cluster by cowid

glm.nb_pre3 <- glm.nb(n_c_y~bi_PRE+mil_ratio+USmilaid+allies+USdefense+USdefense_EUR+UStrade+energypc+USalign+UNpart+mpower+FOR+CAR+demo+bi_L14_SOS+bi_L14_PRE+bi_L58_SOS+bi_L58_PRE+EUR+AFR+MEA+SCA+EAP, data = cable_n_vis_country_y)
#Cluster by cowid

glm.nb_sos3 <- glm.nb(n_c_y~bi_SOS+mil_ratio+USmilaid+allies+USdefense+USdefense_EUR+UStrade+energypc+USalign+UNpart+mpower+FOR+CAR+demo+bi_L14_SOS+bi_L14_PRE+bi_L58_SOS+bi_L58_PRE+EUR+AFR+MEA+SCA+EAP, data = cable_n_vis_country_y)
#Cluster by cowid

#Check model assumptions and robustness (https://stats.idre.ucla.edu/r/dae/negative-binomial-regression/)

#Consider using the event count time series models PAR(p) and PEWMA models (http://www.utdallas.edu/~pbrandt/Patrick_Brandts_Website/Code_%26_Software.html) or negative binomials or tscount (https://cran.r-project.org/web/packages/tscount/vignettes/tsglm.pdf) for robustness check.

#Negotive binomial regression models
stargazer(glm.nb_pre1, glm.nb_pre2, glm.nb_pre3, 
          type="html",
          dep.var.labels=c("Number of Cables Tagged"),
          #covariate.labels=c("Gross horsepower","Rear axle ratio","Four foward gears","Five forward gears","Type of transmission (manual=1)"), 
          out="../data_analysis_output/cable_n_pres_visit.html"
          )

stargazer(glm.nb_sos1, glm.nb_sos2, glm.nb_sos3, 
          type="html",
          dep.var.labels=c("Number of Cables Tagged"),
          #covariate.labels=c("Gross horsepower","Rear axle ratio","Four foward gears","Five forward gears","Type of transmission (manual=1)"), 
          out="../data_analysis_output/cable_n_sos_visit.html"
          )

stargazer(glm.nb_pre1, glm.nb_pre2, glm.nb_pre3, glm.nb_sos1, glm.nb_sos2, glm.nb_sos3, 
          type="html",
          dep.var.labels=c("Number of Cables Tagged"),
          #covariate.labels=c("Gross horsepower","Rear axle ratio","Four foward gears","Five forward gears","Type of transmission (manual=1)"), 
          out="../data_analysis_output/cable_n_visit.html")

stargazer(glm.nb_irep1, glm.nb_app1,
          type="text",
          dep.var.labels=c("Number of Cables Tagged"),
          #covariate.labels=c("Gross horsepower","Rear axle ratio","Four foward gears","Five forward gears","Type of transmission (manual=1)"), 
          out="../data_analysis_output/cable_n_irep_app.txt")
```

#Compare the yearly cable traffic with the country-year data on diplomatic visits
```{r, results="hide",warning=FALSE,message=FALSE}
cable_n_vis_country_y<-
  cable_n_country_y %>%
  rename(cowid=cow_ccode) %>%
  inner_join(us_dip_vis, by=c("year", "cowid")) 

glm.nb_pre1 <- glm.nb(n_c_y~bi_PRE, data = cable_n_vis_country_y)

glm.nb_pre1 <- glm.nb(n_c_y~bi_PRE, data = cable_n_vis_country_y)
glm.nb_sos1 <- glm.nb(n_c_y~bi_SOS, data = cable_n_vis_country_y)

#Slightly modified from the analysis in Lebovic and Saunders (2016)' Tables 3 and 4
glm.nb_pre2 <- glm.nb(n_c_y~bi_PRE+mil_ratio+USmilaid+allies+USdefense+USdefense_EUR+UStrade+energypc+USalign+UNpart+mpower+FOR+CAR+demo+bi_L1_PRE+EUR+AFR+MEA+SCA+EAP, data = cable_n_vis_country_y)
#Cluster by cowid

glm.nb_sos2 <- glm.nb(n_c_y~bi_SOS+mil_ratio+USmilaid+allies+USdefense+USdefense_EUR+UStrade+energypc+USalign+UNpart+mpower+FOR+CAR+demo+bi_L1_PRE+EUR+AFR+MEA+SCA+EAP, data = cable_n_vis_country_y)
#Cluster by cowid

glm.nb_pre3 <- glm.nb(n_c_y~bi_PRE+mil_ratio+USmilaid+allies+USdefense+USdefense_EUR+UStrade+energypc+USalign+UNpart+mpower+FOR+CAR+demo+bi_L14_SOS+bi_L14_PRE+bi_L58_SOS+bi_L58_PRE+EUR+AFR+MEA+SCA+EAP, data = cable_n_vis_country_y)
#Cluster by cowid

glm.nb_sos3 <- glm.nb(n_c_y~bi_SOS+mil_ratio+USmilaid+allies+USdefense+USdefense_EUR+UStrade+energypc+USalign+UNpart+mpower+FOR+CAR+demo+bi_L14_SOS+bi_L14_PRE+bi_L58_SOS+bi_L58_PRE+EUR+AFR+MEA+SCA+EAP, data = cable_n_vis_country_y)
#Cluster by cowid

#Check model assumptions and robustness (https://stats.idre.ucla.edu/r/dae/negative-binomial-regression/)

#Consider using the event count time series models PAR(p) and PEWMA models (http://www.utdallas.edu/~pbrandt/Patrick_Brandts_Website/Code_%26_Software.html) or negative binomials or tscount (https://cran.r-project.org/web/packages/tscount/vignettes/tsglm.pdf) for robustness check.

#Negotive binomial regression models
stargazer(glm.nb_pre1, glm.nb_pre2, glm.nb_pre3, 
          type="html",
          dep.var.labels=c("Number of Cables Tagged"),
          #covariate.labels=c("Gross horsepower","Rear axle ratio","Four foward gears","Five forward gears","Type of transmission (manual=1)"), 
          out="../data_analysis_output/cable_n_pres_visit.html"
          )

stargazer(glm.nb_sos1, glm.nb_sos2, glm.nb_sos3, 
          type="html",
          dep.var.labels=c("Number of Cables Tagged"),
          #covariate.labels=c("Gross horsepower","Rear axle ratio","Four foward gears","Five forward gears","Type of transmission (manual=1)"), 
          out="../data_analysis_output/cable_n_sos_visit.html"
          )

stargazer(glm.nb_pre1, glm.nb_pre2, glm.nb_pre3, glm.nb_sos1, glm.nb_sos2, glm.nb_sos3, 
          type="html",
          dep.var.labels=c("Number of Cables Tagged"),
          #covariate.labels=c("Gross horsepower","Rear axle ratio","Four foward gears","Five forward gears","Type of transmission (manual=1)"), 
          out="../data_analysis_output/cable_n_visit.html")

stargazer(glm.nb_pre1, glm.nb_pre2, glm.nb_pre3, glm.nb_sos1, glm.nb_sos2, glm.nb_sos3, 
          type="text",
          dep.var.labels=c("Number of Cables Tagged"),
          #covariate.labels=c("Gross horsepower","Rear axle ratio","Four foward gears","Five forward gears","Type of transmission (manual=1)"), 
          out="../data_analysis_output/cable_n_visit.txt")
```


